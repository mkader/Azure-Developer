# Create a long-running serverless workflow with Durable Functions

## Introduction
* Durable Functions is an extension of Azure Functions that lets you perform long-lasting, stateful operations in Azure. 
* Azure provides the infrastructure for maintaining state information. You can use Durable Functions to orchestrate a long-running workflow. 
* Using this approach, you get all the benefits of a serverless hosting model while letting the Durable Functions framework take care of activity monitoring, synchronization, and runtime concerns.

## What is Durable Functions?
* Durable Functions allows you to implement complex stateful functions in a serverless-environment.

* scenario, company follows a manual approval process for project-design proposals. The process has multiple steps, and each step in the process can vary in duration. Implementing an automated process in-house is complex and costly. Coordinating each step takes effort. In addition, you must be able to incorporate custom logic into the workflow.

* Durable functions 
    1. Durable Functions is an extension of Azure Functions. Whereas Azure Functions operates in a stateless environment, Durable Functions can retain state between function calls. This approach allows you to simplify complex stateful executions in a serverless environment.
    1. Durable Functions scales as needed and provides a cost-effective means of implementing complex workflows in the cloud. 
    1. Some benefits of using Durable Functions include:
        1. They enable you to write event driven code. A durable function can wait asynchronously for one or more external events, then perform a series of tasks in response to these events.
        1. You can chain functions together. You can implement common patterns such as fan-out/fan-in, which uses one function to invoke others in parallel, then accumulate the results.
        1. You can orchestrate and coordinate functions and specify the order in which functions should execute.
        1. The state is managed for you. You don't have to write your own code to save state information for a long-running function.
    1. Durable Functions allows you to define stateful workflows using an orchestration function. An orchestration function provides these extra benefits:
        1. You can define the workflows in code. You don't need to write a JSON description or use a workflow design tool.
        1. Functions can be called both synchronously and asynchronously. Output from the called functions is saved locally in variables and used in subsequent function calls.
        1. Azure checkpoints the progress of a function automatically when the function awaits. Azure might choose to dehydrate the function and save its state while the function waits to preserve resources and reduce costs. When the function starts running again, Azure will rehydrate it and restore its state.

* Function types - 3 durable function types: Client, Orchestrator, and Activity.
    1. Client functions are the entry point for creating an instance of a Durable Functions orchestration. They can run in response to an event from many sources, such as a new HTTP request arriving, a message being posted to a message queue, an event arriving in an event stream. You can write them in any of the supported languages.
    1. Orchestrator functions describe how actions are executed and the order in which they're run. You write the orchestration logic in code (C# or JavaScript).
    1. Activity functions are the basic units of work in a Durable Functions orchestration. An activity function contains the actual work performed by the tasks being orchestrated.

* Application patterns -Use Durable Functions to implement many common workflow patterns. These patterns include:
    1. Function chaining: the workflow executes a sequence of functions in a specified order. One function's output is applied to the next function's input in the sequence. The final function's output is used to generate a result.
    1. ![](https://learn.microsoft.com/en-us/training/modules/create-long-running-serverless-workflow-with-durable-functions/media/function-chaining.png)
    1. Fan out/fan in: runs multiple functions in parallel and waits for all the functions to finish. You can aggregate the results of the parallel executions or use them to compute a final result.
    1. ![](https://learn.microsoft.com/en-us/training/modules/create-long-running-serverless-workflow-with-durable-functions/media/fan-out-fan-in.png)
    1. Async HTTP APIs: addresses the problem of coordinating state of long-running operations with external clients. An HTTP call can trigger the long-running action, then redirect the client to a status endpoint. The client can learn when the operation is finished by polling this endpoint.
    1. ![](https://learn.microsoft.com/en-us/training/modules/create-long-running-serverless-workflow-with-durable-functions/media/async-http-api.png)
    1. Monitor: implements a recurring process in a workflow, possibly looking for a change in state. For example, you could use this pattern to poll until specific conditions are met.
    1. ![](https://learn.microsoft.com/en-us/training/modules/create-long-running-serverless-workflow-with-durable-functions/media/monitor.png)
    1. Human interaction: combines automated processes that also involve some human interaction. A manual process within an automated process is tricky because people aren't as highly available and as responsive as most computers. You can incorporate human interaction using timeouts and compensation logic that runs if the human fails to interact correctly within a specified response time. An approval process is an example of a process that involves human interaction.
    1. ![](https://learn.microsoft.com/en-us/training/modules/create-long-running-serverless-workflow-with-durable-functions/media/approval.png)

* Comparison with Logic Apps
    1. Durable Functions and Logic Apps are both Azure services that enable serverless workload. 
    1. Azure Durable Functions is intended as a powerful serverless compute option to run custom logic. 
    1. Azure Logic Apps is better suited for integrating Azure services and components. 
    1. Use either technology to create complex orchestrations. 
    1. With Azure Durable Functions, you develop orchestrations by writing code and using the Durable Functions extension. 
    1. With Logic Apps, you create orchestrations by using the design surface or editing configuration files.
    1. key differences between Azure Durable Functions and Azure Logic Apps.

| Task	| Azure Durable Functions	| Azure Logic Apps
| --| --| --| 
| Development	| Code-first (imperative)	| Design-first (declarative)
| Connectivity	| About a dozen built-in binding types. You can write code for custom bindings.	| Large collection of connectors. Enterprise Integration Pack for B2B. You can also build custom connectors.
| Actions	| Each activity is an Azure Function. You write the code for activity functions.	| Large collection of ready-made actions. You integrate custom logic through custom connectors.
| Monitoring	| Azure Application Insights	| Azure portal, Azure Monitor logs
| Management	| REST API, PowerShell, Visual Studio	Azure portal, | REST API, PowerShell, Visual Studio, Visual Studio Code extension

* Check your knowledge
1. What is Durable Functions? 
    1. [x] Durable Functions is an extension of Azure Functions that allows you to simplify complex stateful executions in a serverless-environment
    1. [ ] Durable Functions is a logical container for a single workflow that you define using triggers and actions.
    1. [ ] Durable Functions is a serverless compute service that enables you to run code on-demand without having to explicitly provision or manage infrastructure.

2. Which of the following best describes the role of the Orchestrator function in a workflow? 
    1. [ ] It's used as the basic unit of work (actions and tasks) in a durable function orchestration.
    1. [ ] It's the entry point for creating an instance of a Durable Functions orchestration.
    1. [x] It's used for describing how actions are executed and the order in which actions are executed.

3. Which of the following best explains why the Human Interaction application pattern benefits from Durable Functions? 
    1. [x] A manual process within an automated process because people aren't as highly available and as responsive as computers.
    1. [ ] It addresses the problem of coordinating the state of long-running operations with external clients.
    1. [ ] It allows the output from one function to be applied to input of the next function in a series of function calls.
